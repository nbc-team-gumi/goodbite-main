name: Java Lint Check

on:
  pull_request:
    types: [ opened, synchronize, reopened ] # 처음 생성시점(opened), 커밋 추가/변경 시점(synchronize), 닫힌 PR 재오픈 시점(reopened)
    branches-ignore: # main, dev를 제외한 모든 브랜치
      - main
      - dev

jobs:
  lint:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up JDK
        uses: actions/setup-java@v2
        with:
          java-version: '21'

      - name: Install dependencies
        run: ./gradlew build -x test

      - name: Run Checkstyle
        run: ./gradlew checkstyleMain

  notify_failure:
    if: failure()
    runs-on: ubuntu-20.04
    steps:
      - name: Send Slack notification
        run: |
          curl -X POST -H 'Content-type: application/json' --data '{
            "text": "❗ *GitHub Actions workflows failure*",
            "attachments": [
              {
                "color": "#ff0000",
                "fields": [
                  { "title": "Repository", "value": "${{ github.repository }}", "short": true },
                  { "title": "Branch", "value": "${{ github.ref }}", "short": true },
                  { "title": "Job", "value": "${{ github.job }}", "short": true },
                  { "title": "Commit Message", "value": "${{ github.event.head_commit.message }}", "short": false },
                  { "title": "URL", "value": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}", "short": false }
                ]
              }
            ]
          }' ${{ secrets.SLACK_WEBHOOK_URL }}